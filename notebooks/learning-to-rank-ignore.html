<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Data pipelines, model fitting and feature selection">

<title>Vespa Data Science - Learning to rank</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="Vespa Data Science - Learning to rank">
<meta property="og:description" content="Data pipelines, model fitting and feature selection">
<meta property="og:image" content="https://vespa.ai/assets/vespa-logo-color.png">
<meta property="og:site-name" content="Vespa Data Science">
<meta name="twitter:title" content="Vespa Data Science - Learning to rank">
<meta name="twitter:description" content="Data pipelines, model fitting and feature selection">
<meta name="twitter:image" content="https://vespa.ai/assets/vespa-logo-color.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Vespa Data Science</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Learning to rank</li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vespa for Data Scientists</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Use-case experiments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Passage Ranking</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../passage_dataset.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dataset</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../passage_uncertainty_evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IR evaluation metrics with uncertainty estimates</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Model serving</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stateless_sequence_classification_task.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sequence Classification task</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Use-case modules</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module_passage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">passage</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">WIP notebooks</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/collect-training-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Collect training data from application</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Evaluate application</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/query-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Query models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/cord19/cord19_connect_evaluate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to evaluate Vespa ranking functions from python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/cord19/cord19_download_parse_trec_covid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to download and parse TREC-COVID data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/image_search/image-search-scratch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Image search</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/tensorflow-via-onnx.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TensorFlow: Deploy model to Vespa through ONNX</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Core modules</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">stats</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module_evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">evaluation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module_query.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">query</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module_ranking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ranking</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module_ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ml</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a></li>
  <li><a href="#listwise-ranking-framework" id="toc-listwise-ranking-framework" class="nav-link" data-scroll-target="#listwise-ranking-framework">Listwise ranking framework</a>
  <ul class="collapse">
  <li><a href="#data-pipeline" id="toc-data-pipeline" class="nav-link" data-scroll-target="#data-pipeline">Data pipeline</a></li>
  <li><a href="#pre-defined-models" id="toc-pre-defined-models" class="nav-link" data-scroll-target="#pre-defined-models">Pre-defined models</a></li>
  <li><a href="#feature-selection" id="toc-feature-selection" class="nav-link" data-scroll-target="#feature-selection">Feature selection</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/vespa-engine/learntorank/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Learning to rank</h1>
</div>

<div>
  <div class="description">
    Data pipelines, model fitting and feature selection
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://vespa.ai/assets/vespa-logo-color.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Vespa logo</figcaption>
</figure>
</div>
<p>This notebook is WIP and not runnable - ToDo FIXME</p>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>This section describes the data that we are going to use to give a brief overview of the <code>pyvespa</code> ranking framework. The data was collected from a running Vespa application indexed with MS MARCO data. For each relevant (<code>document_id</code>, <code>query_id</code>)-pair we collected 9 random matched documents. Relevant documents have <code>label=1</code> and non-relevant documents have <code>label=0</code>. In addition, many <a href="https://docs.vespa.ai/en/reference/rank-features.html">Vespa ranking features</a> computed based on document and query interaction are included.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>train_df <span class="op">=</span> pd.read_csv(<span class="st">"https://data.vespa.oath.cloud/blog/ranking/train_sample.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The data used here is a sample containing 100.000 rows and 71 features.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>train_df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(100000, 74)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>train_df.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">document_id</th>
<th data-quarto-table-cell-role="th">query_id</th>
<th data-quarto-table-cell-role="th">label</th>
<th data-quarto-table-cell-role="th">elementCompleteness(body).completeness</th>
<th data-quarto-table-cell-role="th">elementCompleteness(body).fieldCompleteness</th>
<th data-quarto-table-cell-role="th">elementCompleteness(body).queryCompleteness</th>
<th data-quarto-table-cell-role="th">fieldMatch(body)</th>
<th data-quarto-table-cell-role="th">fieldMatch(body).absoluteOccurrence</th>
<th data-quarto-table-cell-role="th">fieldMatch(body).absoluteProximity</th>
<th data-quarto-table-cell-role="th">fieldMatch(body).completeness</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">term(3).significance</th>
<th data-quarto-table-cell-role="th">term(3).weight</th>
<th data-quarto-table-cell-role="th">term(4).connectedness</th>
<th data-quarto-table-cell-role="th">term(4).significance</th>
<th data-quarto-table-cell-role="th">term(4).weight</th>
<th data-quarto-table-cell-role="th">textSimilarity(body).fieldCoverage</th>
<th data-quarto-table-cell-role="th">textSimilarity(body).order</th>
<th data-quarto-table-cell-role="th">textSimilarity(body).proximity</th>
<th data-quarto-table-cell-role="th">textSimilarity(body).queryCoverage</th>
<th data-quarto-table-cell-role="th">textSimilarity(body).score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>27061</td>
<td>3</td>
<td>0</td>
<td>0.358796</td>
<td>0.092593</td>
<td>0.625</td>
<td>0.127746</td>
<td>0.022000</td>
<td>0.02600</td>
<td>0.598380</td>
<td>...</td>
<td>0.504935</td>
<td>100.0</td>
<td>0.1</td>
<td>0.674337</td>
<td>100.0</td>
<td>0.092593</td>
<td>0.250000</td>
<td>0.437500</td>
<td>0.625</td>
<td>0.396644</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>257</td>
<td>3</td>
<td>0</td>
<td>0.359670</td>
<td>0.094340</td>
<td>0.625</td>
<td>0.092319</td>
<td>0.018000</td>
<td>0.03500</td>
<td>0.598467</td>
<td>...</td>
<td>0.504935</td>
<td>100.0</td>
<td>0.1</td>
<td>0.674337</td>
<td>100.0</td>
<td>0.094340</td>
<td>0.750000</td>
<td>0.234375</td>
<td>0.625</td>
<td>0.400899</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>363</td>
<td>3</td>
<td>0</td>
<td>0.277397</td>
<td>0.054795</td>
<td>0.500</td>
<td>0.141511</td>
<td>0.030000</td>
<td>0.07100</td>
<td>0.477740</td>
<td>...</td>
<td>0.504935</td>
<td>100.0</td>
<td>0.1</td>
<td>0.674337</td>
<td>100.0</td>
<td>0.054795</td>
<td>0.666667</td>
<td>0.640625</td>
<td>0.500</td>
<td>0.485178</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>22682</td>
<td>3</td>
<td>0</td>
<td>0.333686</td>
<td>0.042373</td>
<td>0.625</td>
<td>0.250817</td>
<td>0.056000</td>
<td>0.10000</td>
<td>0.595869</td>
<td>...</td>
<td>0.504935</td>
<td>100.0</td>
<td>0.1</td>
<td>0.674337</td>
<td>100.0</td>
<td>0.042373</td>
<td>0.250000</td>
<td>0.324219</td>
<td>0.625</td>
<td>0.346951</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>160</td>
<td>3</td>
<td>0</td>
<td>0.295455</td>
<td>0.090909</td>
<td>0.500</td>
<td>0.118351</td>
<td>0.015000</td>
<td>0.05000</td>
<td>0.479545</td>
<td>...</td>
<td>0.504935</td>
<td>100.0</td>
<td>0.1</td>
<td>0.674337</td>
<td>100.0</td>
<td>0.090909</td>
<td>0.666667</td>
<td>0.557292</td>
<td>0.500</td>
<td>0.463234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>228</td>
<td>3</td>
<td>0</td>
<td>0.286364</td>
<td>0.072727</td>
<td>0.500</td>
<td>0.148612</td>
<td>0.015000</td>
<td>0.10000</td>
<td>0.478636</td>
<td>...</td>
<td>0.504935</td>
<td>100.0</td>
<td>0.1</td>
<td>0.674337</td>
<td>100.0</td>
<td>0.072727</td>
<td>0.000000</td>
<td>0.286458</td>
<td>0.500</td>
<td>0.264806</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>3901893</td>
<td>3</td>
<td>0</td>
<td>0.433824</td>
<td>0.117647</td>
<td>0.750</td>
<td>0.345256</td>
<td>0.025000</td>
<td>0.07700</td>
<td>0.718382</td>
<td>...</td>
<td>0.504935</td>
<td>100.0</td>
<td>0.1</td>
<td>0.674337</td>
<td>100.0</td>
<td>0.117647</td>
<td>0.600000</td>
<td>0.575000</td>
<td>0.750</td>
<td>0.539779</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>1142680</td>
<td>3</td>
<td>1</td>
<td>0.412037</td>
<td>0.074074</td>
<td>0.750</td>
<td>0.343120</td>
<td>0.046667</td>
<td>0.07700</td>
<td>0.716204</td>
<td>...</td>
<td>0.504935</td>
<td>100.0</td>
<td>0.1</td>
<td>0.674337</td>
<td>100.0</td>
<td>0.074074</td>
<td>0.600000</td>
<td>0.615625</td>
<td>0.750</td>
<td>0.545284</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>141</td>
<td>3</td>
<td>0</td>
<td>0.286364</td>
<td>0.072727</td>
<td>0.500</td>
<td>0.081461</td>
<td>0.027500</td>
<td>0.10000</td>
<td>0.478636</td>
<td>...</td>
<td>0.504935</td>
<td>100.0</td>
<td>0.1</td>
<td>0.674337</td>
<td>100.0</td>
<td>0.072727</td>
<td>0.666667</td>
<td>0.406250</td>
<td>0.500</td>
<td>0.406733</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>3060834</td>
<td>3</td>
<td>0</td>
<td>0.410294</td>
<td>0.070588</td>
<td>0.750</td>
<td>0.308250</td>
<td>0.045000</td>
<td>0.06675</td>
<td>0.716029</td>
<td>...</td>
<td>0.504935</td>
<td>100.0</td>
<td>0.1</td>
<td>0.674337</td>
<td>100.0</td>
<td>0.070588</td>
<td>0.400000</td>
<td>0.715625</td>
<td>0.750</td>
<td>0.549586</td>
</tr>
</tbody>
</table>

<p>10 rows × 74 columns</p>
</div>
</div>
</div>
<p>Similarly, we collected data based on the MS MARCO queries contained on the dev set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dev_df <span class="op">=</span> pd.read_csv(<span class="st">"https://data.vespa.oath.cloud/blog/ranking/dev_sample.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dev_df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(74103, 72)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dev_df.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">document_id</th>
<th data-quarto-table-cell-role="th">query_id</th>
<th data-quarto-table-cell-role="th">label</th>
<th data-quarto-table-cell-role="th">elementCompleteness(body).completeness</th>
<th data-quarto-table-cell-role="th">elementCompleteness(body).fieldCompleteness</th>
<th data-quarto-table-cell-role="th">elementCompleteness(body).queryCompleteness</th>
<th data-quarto-table-cell-role="th">fieldMatch(body)</th>
<th data-quarto-table-cell-role="th">fieldMatch(body).absoluteOccurrence</th>
<th data-quarto-table-cell-role="th">fieldMatch(body).absoluteProximity</th>
<th data-quarto-table-cell-role="th">fieldMatch(body).completeness</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">term(3).significance</th>
<th data-quarto-table-cell-role="th">term(3).weight</th>
<th data-quarto-table-cell-role="th">term(4).connectedness</th>
<th data-quarto-table-cell-role="th">term(4).significance</th>
<th data-quarto-table-cell-role="th">term(4).weight</th>
<th data-quarto-table-cell-role="th">textSimilarity(body).fieldCoverage</th>
<th data-quarto-table-cell-role="th">textSimilarity(body).order</th>
<th data-quarto-table-cell-role="th">textSimilarity(body).proximity</th>
<th data-quarto-table-cell-role="th">textSimilarity(body).queryCoverage</th>
<th data-quarto-table-cell-role="th">textSimilarity(body).score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>8066640</td>
<td>2</td>
<td>0</td>
<td>0.380952</td>
<td>0.095238</td>
<td>0.666667</td>
<td>0.427344</td>
<td>0.01</td>
<td>0.1</td>
<td>0.638095</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.095238</td>
<td>1.0</td>
<td>1.0</td>
<td>0.666667</td>
<td>0.719048</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4339068</td>
<td>2</td>
<td>1</td>
<td>0.346667</td>
<td>0.026667</td>
<td>0.666667</td>
<td>0.444933</td>
<td>0.04</td>
<td>0.1</td>
<td>0.634667</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.026667</td>
<td>1.0</td>
<td>1.0</td>
<td>0.666667</td>
<td>0.705333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>762768</td>
<td>2</td>
<td>0</td>
<td>0.343750</td>
<td>0.020833</td>
<td>0.666667</td>
<td>0.088859</td>
<td>0.01</td>
<td>0.1</td>
<td>0.634375</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.020833</td>
<td>1.0</td>
<td>0.0</td>
<td>0.666667</td>
<td>0.354167</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3370</td>
<td>2</td>
<td>0</td>
<td>0.180180</td>
<td>0.027027</td>
<td>0.333333</td>
<td>0.162049</td>
<td>0.01</td>
<td>0.1</td>
<td>0.318018</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.027027</td>
<td>0.0</td>
<td>0.0</td>
<td>0.333333</td>
<td>0.105405</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>6060</td>
<td>2</td>
<td>0</td>
<td>0.175287</td>
<td>0.017241</td>
<td>0.333333</td>
<td>0.145722</td>
<td>0.01</td>
<td>0.1</td>
<td>0.317529</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.017241</td>
<td>0.0</td>
<td>0.0</td>
<td>0.333333</td>
<td>0.103448</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>3798</td>
<td>2</td>
<td>0</td>
<td>0.180556</td>
<td>0.027778</td>
<td>0.333333</td>
<td>0.166942</td>
<td>0.01</td>
<td>0.1</td>
<td>0.318056</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.027778</td>
<td>0.0</td>
<td>0.0</td>
<td>0.333333</td>
<td>0.105556</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2731175</td>
<td>2</td>
<td>0</td>
<td>0.345833</td>
<td>0.025000</td>
<td>0.666667</td>
<td>0.398800</td>
<td>0.01</td>
<td>0.1</td>
<td>0.634583</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.025000</td>
<td>1.0</td>
<td>1.0</td>
<td>0.666667</td>
<td>0.705000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>3634083</td>
<td>2</td>
<td>0</td>
<td>0.351190</td>
<td>0.035714</td>
<td>0.666667</td>
<td>0.423611</td>
<td>0.02</td>
<td>0.1</td>
<td>0.635119</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.035714</td>
<td>1.0</td>
<td>1.0</td>
<td>0.666667</td>
<td>0.707143</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>112126</td>
<td>2</td>
<td>0</td>
<td>0.176282</td>
<td>0.019231</td>
<td>0.333333</td>
<td>0.177009</td>
<td>0.02</td>
<td>0.1</td>
<td>0.317628</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.019231</td>
<td>0.0</td>
<td>0.0</td>
<td>0.333333</td>
<td>0.103846</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>3387</td>
<td>2</td>
<td>0</td>
<td>0.178571</td>
<td>0.023810</td>
<td>0.333333</td>
<td>0.171357</td>
<td>0.01</td>
<td>0.1</td>
<td>0.317857</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.023810</td>
<td>0.0</td>
<td>0.0</td>
<td>0.333333</td>
<td>0.104762</td>
</tr>
</tbody>
</table>

<p>10 rows × 72 columns</p>
</div>
</div>
</div>
</section>
<section id="listwise-ranking-framework" class="level2">
<h2 class="anchored" data-anchor-id="listwise-ranking-framework">Listwise ranking framework</h2>
<p>The <a href="https://thigm85.github.io/learntorank/module_ranking.html#listwiserankingframework"><code>ListwiseRankingFramework</code></a> uses <a href="https://www.tensorflow.org/ranking">TensorFlow Ranking</a> to minimize a listwise loss function that is a smooth approximation of the NDCG metric. The following parameters need to be specified:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> learntorank.ranking <span class="im">import</span> ListwiseRankingFramework</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>ranking_framework <span class="op">=</span> ListwiseRankingFramework(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Task related </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    number_documents_per_query<span class="op">=</span><span class="dv">10</span>,  <span class="co"># The size of the list for each sample</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    top_n<span class="op">=</span><span class="dv">10</span>,                       <span class="co"># What NDCG position we want to optmize, e.g. NDCG@10</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data pipeline </span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">32</span>,                  <span class="co"># Batch size used when fitting models to the data</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    shuffle_buffer_size<span class="op">=</span><span class="dv">1000</span>,       <span class="co"># The buffer size used when shuffling data batches.</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Hyperparameter tuning </span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    tuner_max_trials<span class="op">=</span><span class="dv">3</span>,             <span class="co"># How many trials to execute when search hyperparameters</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    tuner_executions_per_trial<span class="op">=</span><span class="dv">1</span>,   <span class="co"># How may model fit per trial</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    tuner_epochs<span class="op">=</span><span class="dv">10</span>,                <span class="co"># How many epochs to use per execution of the trial</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    tuner_early_stop_patience<span class="op">=</span><span class="va">None</span>, <span class="co"># Set patience number for early stopping</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Final model</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    final_epochs<span class="op">=</span><span class="dv">30</span>                 <span class="co"># Number of epochs to use when fitting the model with specific hyperparameters.</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>WARNING:tensorflow:There are non-GPU devices in `tf.distribute.Strategy`, not using nccl allreduce.
INFO:tensorflow:Using MirroredStrategy with devices ('/job:localhost/replica:0/task:0/device:CPU:0',)</code></pre>
</div>
</div>
<section id="data-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="data-pipeline">Data pipeline</h3>
<p>It is possible to create TensorFlow data pipelines (<code>tf.data.Dataset</code>) either from in-memory data frames or directly from .csv files to avoid the need to load large file into memory. The data pipelines are suited for listwise ranking and can be used as part of a custom tensorflow workflow if desired.</p>
<p>Create a <code>tf.data.Dataset</code> from in-memory data frames:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>tf_ds <span class="op">=</span> ranking_framework.listwise_tf_dataset_from_df(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>train_df, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    feature_names<span class="op">=</span>[<span class="st">"nativeFieldMatch"</span>, <span class="st">"nativeProximity"</span>, <span class="st">"nativeRank"</span>],</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    shuffle_buffer_size<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">1</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the is already suited for listwise learning.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> batch <span class="kw">in</span> tf_ds.take(<span class="dv">1</span>):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(batch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&lt;tf.Tensor: shape=(1, 10, 3), dtype=float32, numpy=
array([[[1.9765680e-01, 6.5953881e-02, 9.5175676e-02],
        [1.3242842e-01, 1.1140537e-01, 7.1235448e-02],
        [3.4112938e-02, 1.2160993e-37, 1.5161305e-02],
        [1.5705481e-01, 4.0344268e-02, 7.4284837e-02],
        [8.6454414e-02, 3.2825880e-02, 4.2071503e-02],
        [1.9139472e-01, 1.1913208e-01, 9.8301217e-02],
        [4.8045117e-02, 1.2160993e-37, 2.1353386e-02],
        [1.4903504e-01, 1.3032080e-01, 8.0717884e-02],
        [6.3953400e-02, 2.8740479e-02, 3.1617120e-02],
        [1.5656856e-01, 6.8069249e-02, 7.7149279e-02]]], dtype=float32)&gt;, &lt;tf.Tensor: shape=(1, 10), dtype=float32, numpy=array([[0., 0., 0., 0., 0., 0., 0., 1., 0., 0.]], dtype=float32)&gt;)</code></pre>
</div>
</div>
<p>For large data, we can also create a listwise <code>tf.data.Dataset</code> directly from a .csv file, without the need to load it into memory:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>train_df.to_csv(<span class="st">"train_sample.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>tf_ds <span class="op">=</span> ranking_framework.listwise_tf_dataset_from_csv(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    file_path<span class="op">=</span><span class="st">"train_sample.csv"</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    feature_names<span class="op">=</span>[<span class="st">"nativeFieldMatch"</span>, <span class="st">"nativeProximity"</span>, <span class="st">"nativeRank"</span>],</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    shuffle_buffer_size<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">1</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> batch <span class="kw">in</span> tf_ds.take(<span class="dv">1</span>):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(batch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&lt;tf.Tensor: shape=(1, 10, 3), dtype=float32, numpy=
array([[[0.08348585, 0.04784278, 0.04242069],
        [0.08451388, 0.01466913, 0.03919163],
        [0.07139124, 0.02419666, 0.03441796],
        [0.07348892, 0.02119719, 0.03501699],
        [0.11205826, 0.10210748, 0.06114895],
        [0.06779736, 0.02308168, 0.03269679],
        [0.08361208, 0.00839302, 0.03809348],
        [0.13477945, 0.13513905, 0.07491743],
        [0.17734438, 0.18263273, 0.09911225],
        [0.12978926, 0.15896696, 0.07534712]]], dtype=float32)&gt;, &lt;tf.Tensor: shape=(1, 10), dtype=float32, numpy=array([[0., 0., 0., 0., 0., 0., 0., 0., 1., 0.]], dtype=float32)&gt;)</code></pre>
</div>
</div>
</section>
<section id="pre-defined-models" class="level3">
<h3 class="anchored" data-anchor-id="pre-defined-models">Pre-defined models</h3>
<p>The ranking framework comes with same pre-defined models in case you don’t want to use the data pipelines to create your own workflow. It is possible to specify either a <code>DataFrame</code> or a <code>.csv</code> file path as the train and dev input data. If the <code>hyperparameters</code> argument is not specified it will search through the hyperparameter space accordinng to the arguments defined when creating and instance of the <a href="https://thigm85.github.io/learntorank/module_ranking.html#listwiserankingframework"><code>ListwiseRankingFramework</code></a>.</p>
<section id="linear-model" class="level4">
<h4 class="anchored" data-anchor-id="linear-model">Linear model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>weights, dev_eval, best_hyperparams <span class="op">=</span> ranking_framework.fit_linear_model(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    train_data<span class="op">=</span>train_df, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    dev_data<span class="op">=</span>dev_df, </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    feature_names<span class="op">=</span>[</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fieldMatch(body).proximity"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fieldMatch(body).queryCompleteness"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fieldMatch(body).significance"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nativeFieldMatch"</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nativeProximity"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nativeRank"</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    hyperparameters<span class="op">=</span><span class="va">None</span> <span class="co"># Search for best hyperparameters</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>best_hyperparams</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'learning_rate': 6.018683626059954}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'feature_names': ['fieldMatch(body).proximity',
  'fieldMatch(body).queryCompleteness',
  'fieldMatch(body).significance',
  'nativeFieldMatch',
  'nativeProximity',
  'nativeRank'],
 'linear_model_weights': [0.46931159496307373,
  -30.97307014465332,
  28.785017013549805,
  18.257308959960938,
  12.566983222961426,
  10.918502807617188]}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dev_eval</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.7916887402534485</code></pre>
</div>
</div>
<p>If we instead specify the hyperpameters, hyperparameter search will be skipped.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>weights, dev_eval, best_hyperparams <span class="op">=</span> ranking_framework.fit_linear_model(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    train_data<span class="op">=</span>train_df, </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    dev_data<span class="op">=</span>dev_df, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    feature_names<span class="op">=</span>[</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fieldMatch(body).proximity"</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fieldMatch(body).queryCompleteness"</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fieldMatch(body).significance"</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nativeFieldMatch"</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nativeProximity"</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nativeRank"</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    hyperparameters<span class="op">=</span>{<span class="st">'learning_rate'</span>: <span class="fl">6.018683626059954</span>} </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lasso-model" class="level4">
<h4 class="anchored" data-anchor-id="lasso-model">Lasso model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>weights, dev_eval, best_hyperparams <span class="op">=</span> ranking_framework.fit_lasso_linear_model(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    train_data<span class="op">=</span>train_df, </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    dev_data<span class="op">=</span>dev_df, </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    feature_names<span class="op">=</span>[</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fieldMatch(body).proximity"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fieldMatch(body).queryCompleteness"</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fieldMatch(body).significance"</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nativeFieldMatch"</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nativeProximity"</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nativeRank"</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(best_hyperparams)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'lambda': 0.0023227311360666802, 'learning_rate': 0.14885653869373894}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(weights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'feature_names': ['fieldMatch(body).proximity', 'fieldMatch(body).queryCompleteness', 'fieldMatch(body).significance', 'nativeFieldMatch', 'nativeProximity', 'nativeRank'], 'normalization_mean': [0.8184928894042969, 0.530807375907898, 0.5052036643028259, 0.0906180813908577, 0.039063721895217896, 0.04461509734392166], 'normalization_sd': [0.08662283420562744, 0.05760122463107109, 0.06236378848552704, 0.003072209656238556, 0.003147233510389924, 0.0008713427814655006], 'normalization_number_data': 96990, 'linear_model_weights': [-0.022373167797923088, -2.1850321292877197, 2.055746078491211, 0.21248634159564972, 0.2774745225906372, 0.6118378043174744]}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dev_eval)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.7700856328010559</code></pre>
</div>
</div>
</section>
</section>
<section id="feature-selection" class="level3">
<h3 class="anchored" data-anchor-id="feature-selection">Feature selection</h3>
<p>The are some pre-defined algorithms that can be used for feature selection. The goal is to find a subset of features that are responsible for most of the evaluation metric gains.</p>
<section id="lasso-model-search" class="level4">
<h4 class="anchored" data-anchor-id="lasso-model-search">Lasso model search</h4>
<p>Fit a lasso model with all <code>feature_names</code>. Sequentially remove the feature with the smallest absolute weight until there is only one feature in the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> ranking_framework.lasso_model_search(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    train_data<span class="op">=</span>train_df, </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    dev_data<span class="op">=</span>dev_df, </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    feature_names<span class="op">=</span>[</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fieldMatch(body).proximity"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fieldMatch(body).queryCompleteness"</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fieldMatch(body).significance"</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nativeFieldMatch"</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nativeProximity"</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nativeRank"</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    output_file<span class="op">=</span><span class="st">"lasso_model_search.json"</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Number of features </span><span class="sc">{</span><span class="bu">len</span>(result[<span class="st">'weights'</span>][<span class="st">'feature_names'</span>])<span class="sc">}</span><span class="ss">; Eval metric: </span><span class="sc">{</span>result[<span class="st">'evaluation'</span>]<span class="sc">}</span><span class="ss">"</span>  </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> result <span class="kw">in</span> results</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['Number of features 6; Eval metric: 0.7820510864257812',
 'Number of features 5; Eval metric: 0.7812100052833557',
 'Number of features 4; Eval metric: 0.7958707809448242',
 'Number of features 3; Eval metric: 0.7378504872322083',
 'Number of features 2; Eval metric: 0.7098456025123596',
 'Number of features 1; Eval metric: 0.7048170566558838']</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>[result[<span class="st">'weights'</span>][<span class="st">'feature_names'</span>] <span class="cf">for</span> result <span class="kw">in</span> results]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[['fieldMatch(body).proximity',
  'fieldMatch(body).queryCompleteness',
  'fieldMatch(body).significance',
  'nativeFieldMatch',
  'nativeProximity',
  'nativeRank'],
 ['fieldMatch(body).queryCompleteness',
  'fieldMatch(body).significance',
  'nativeFieldMatch',
  'nativeProximity',
  'nativeRank'],
 ['fieldMatch(body).queryCompleteness',
  'fieldMatch(body).significance',
  'nativeFieldMatch',
  'nativeRank'],
 ['fieldMatch(body).queryCompleteness',
  'fieldMatch(body).significance',
  'nativeRank'],
 ['fieldMatch(body).queryCompleteness', 'nativeRank'],
 ['nativeRank']]</code></pre>
</div>
</div>
</section>
<section id="forward-selection" class="level4">
<h4 class="anchored" data-anchor-id="forward-selection">Forward selection</h4>
<p>Incrementally add one feature at a time and keep the features that maximize the validation metric.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>forward_results <span class="op">=</span> ranking_framework.forward_selection_model_search(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    train_data<span class="op">=</span>train_df, </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    dev_data<span class="op">=</span>dev_df, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    feature_names<span class="op">=</span>[</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fieldMatch(body).proximity"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fieldMatch(body).queryCompleteness"</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fieldMatch(body).significance"</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nativeFieldMatch"</span>,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nativeProximity"</span>,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nativeRank"</span>,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    output_file<span class="op">=</span><span class="st">"forward_model_search.json"</span>,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Evaluation metric for one feature model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    (result[<span class="st">"evaluation"</span>], result[<span class="st">"weights"</span>][<span class="st">"feature_names"</span>]) <span class="cf">for</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>     result <span class="kw">in</span> forward_results </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> result[<span class="st">"number_features"</span>] <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[(0.4771268367767334, ['fieldMatch(body).proximity']),
 (0.5774978995323181, ['fieldMatch(body).queryCompleteness']),
 (0.3523213565349579, ['fieldMatch(body).significance']),
 (0.693596601486206, ['nativeFieldMatch']),
 (0.673930287361145, ['nativeProximity']),
 (0.704784631729126, ['nativeRank'])]</code></pre>
</div>
</div>
<p>Evaluation metric for two features keeping the best feature of the oe-feature model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    (result[<span class="st">"evaluation"</span>], result[<span class="st">"weights"</span>][<span class="st">"feature_names"</span>]) <span class="cf">for</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>     result <span class="kw">in</span> forward_results </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> result[<span class="st">"number_features"</span>] <span class="op">==</span> <span class="dv">2</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[(0.7052107453346252, ['nativeRank', 'fieldMatch(body).proximity']),
 (0.7083131670951843, ['nativeRank', 'fieldMatch(body).queryCompleteness']),
 (0.7050297260284424, ['nativeRank', 'fieldMatch(body).significance']),
 (0.7048313617706299, ['nativeRank', 'nativeFieldMatch']),
 (0.7088075876235962, ['nativeRank', 'nativeProximity'])]</code></pre>
</div>
</div>
<p>And so on:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    (result[<span class="st">"evaluation"</span>], result[<span class="st">"weights"</span>][<span class="st">"feature_names"</span>]) <span class="cf">for</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>     result <span class="kw">in</span> forward_results </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> result[<span class="st">"number_features"</span>] <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[(0.7087035179138184,
  ['nativeRank', 'nativeProximity', 'fieldMatch(body).proximity']),
 (0.7237873673439026,
  ['nativeRank', 'nativeProximity', 'fieldMatch(body).queryCompleteness']),
 (0.7073785662651062,
  ['nativeRank', 'nativeProximity', 'fieldMatch(body).significance']),
 (0.709153413772583, ['nativeRank', 'nativeProximity', 'nativeFieldMatch'])]</code></pre>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>